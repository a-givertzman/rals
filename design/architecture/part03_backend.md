# Бэкенд

* Работает как сервис
* Опрашивает подключенные устройства
    * Пром-контроллеры (Profinet / SLMP)
    * Датчики виброаналитики (UDP)
* Собирает и обрабатывает информацию
    * Пишет историю по событиям
    * Расчитывает износ оборудования
    * Аналитике по датчикам вибрации
        * Датчики вибрации подключены по UDP к бэкенду (Микросервис UDP-Client)
            * Передают выборки с АЦП с частотой семплирования около 300 кГц
        * Микросервис UDP-Client Собирает все выборки с подключенных датчиков
            * Выполняет FFT для каждой выборки
            * Массив результатов FFT поступает на фильтры (индивидуальный Threshold-фильтр, отсекающий несущественные колебания амплитуды)
            * После фильтрации результаты FFT имеющие существенные изменения попадают в таблицу "day" БД (timestamp, freq, amp) для дальнейшей фильтрации
            * Отдельно сохраняем
                * Высокочастотные (Зарождение дефекта (микротрещины, поверхностная усталость))
                    * Собственные частоты элементов подшипника 1 .. 5 кГц (независимо от частоты вращения вала)
                    * Резонансные частоты датчика и корпуса 10 .. 30 кГц (High Frequency Detection (HFD), Shock Pulse Method (SPM) - метод ударных импульсов)
                    * Спектр огибающей (Envelope Spectrum)
                        * Полосовой фильтр к области 20–40 кГц
                        * «Снять огибающую»,
                        * Проверить наличие импульсов, следующие с частотами BPFO или BPFI
                * FTF - Частота сепаратора (Fundamental Train Frequency)
                * BPFI - Частота дефекта внутреннего кольца (Ball Pass Freq. Inner)
                * BPFO - Частота дефекта наружного кольца (Ball Pass Freq. Outer)
                * BSF - Частота дефекта тела качения (Ball Spin Frequency)

        * Микросервис Аналитика Вибрации
            * Микросервис фильтрации
                * Запускается периодически
                    * Раз в 24 часа
                        * все записи из таблички day филтруются от периодических составляющих (с настройками перодов 1), результаты попадают в таблицу week
                    * Раз в 7 дней
                        * Все записи из таблички week филтруются от периодических составляющих (с настройками перодов 2), результаты попадают в таблицу month
                    * Раз в 30 дней
                        * Все записи из таблички month филтруются от периодических составляющих (с настройками перодов 2), результаты попадают в таблицу year
                    * Раз в 360 дней
                        * Все записи из таблички month филтруются от периодических составляющих (с настройками перодов 2), результаты попадают в таблицу va-trend
            * Микросервис Аналитики
                * Запускается по запросу фронтенда
        * Степень износа
            * Ранняя стадия: Появление высокочастотных составляющих (ультразвук) и гармоник. (Warning)
            * Развитый дефект: Появление выраженных пиков на основных частотах и их гармониках (2x, 3x BPFO). (Alarm)
            * Критический износ: Рост «шумового порога» (noise floor) и исчезновение четких пиков из-за хаотичного биения. (Alarm)
* Отправляет текущие значения износа и сигнализации клиентам
* Слушает события от фронтенда
    * Выполняет команды
    * Отвечает на запросы
