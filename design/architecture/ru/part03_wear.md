# Износ оборудования

Подсистема предназначена для:

* хранения нормативного ресурса оборудования
* расчёта накопленного износа
* хранения диагностических показателей состояния
* унифицированной оценки степени дефекта
* последующего использования в прогнозировании и графиках ТО

Подсистема разделена на:

1. Ресурсный износ
2. Диагностический износ

---

# 1. Ресурсный износ

## 1.1 Назначение

Ресурсный износ отражает степень выработки нормативного срока службы оборудования на основе накопленной наработки.

Используется для:

* планового ТО
* расчёта остаточного ресурса
* формирования предупреждений

---

## 1.2 Таблица `equipment_resource_state`

> Текущее расчётное ресурсное состояние оборудования
> Связь: 1 : 1 с `equipment`

| Поле                | Тип             | Обяз. | Описание                    |
| ------------------- | --------------- | ----- | --------------------------- |
| equipment_id        | BIGINT (PK, FK) | ✔     | Идентификатор оборудования  |
| base_resource_hours | NUMERIC(14,2)   | ✔     | Паспортный ресурс (часов)   |
| used_resource_hours | NUMERIC(14,2)   | ✔     | Накопленная наработка       |
| remaining_hours     | NUMERIC(14,2)   | ✔     | Расчётный остаточный ресурс |
| calculated_at       | TIMESTAMP       | ✔     | Время последнего расчёта    |

### Вычисляемые значения

```
wear_percent = used_resource_hours / base_resource_hours * 100
```

`wear_percent` в БД не хранится.

---

# 2. Диагностический износ

## 2.1 Назначение

Диагностический износ отражает текущее техническое состояние оборудования на основе расчётных диагностических показателей:

* вибрация
* температура
* нагрузка
* электрические параметры
* смазка
* геометрия
* и др.

Модель универсальна и не привязана к конкретному типу оборудования.

---

# 2.2 Группы диагностических показателей

## Таблица `diagnostic_group`

> Классификация показателей по физической природе

| Поле | Тип           | Обяз. | Описание             |
| ---- | ------------- | ----- | -------------------- |
| id   | SMALLINT (PK) | ✔     | Идентификатор группы |
| code | TEXT (UNIQUE) | ✔     | Системный код группы |
| name | TEXT          | ✔     | Название группы      |

### Примеры групп

| code        | name                    |
| ----------- | ----------------------- |
| vibration   | Вибрация                |
| temperature | Температура             |
| rotation    | Вращение                |
| load        | Нагрузка                |
| lubrication | Смазка                  |
| electrical  | Электрические параметры |
| structural  | Геометрия и деформации  |

---

# 2.3 Типы диагностических индикаторов

## Таблица `diagnostic_indicator_type`

> Справочник всех возможных диагностических параметров

| Поле        | Тип           | Обяз. | Описание                                 |
| ----------- | ------------- | ----- | ---------------------------------------- |
| id          | SMALLINT (PK) | ✔     | Идентификатор индикатора                 |
| group_id    | SMALLINT (FK) | ✔     | Ссылка на группу                         |
| code        | TEXT (UNIQUE) | ✔     | Системный код (например: BPFO, TEMP_MAX) |
| name        | TEXT          | ✔     | Название индикатора                      |
| unit        | TEXT          |       | Единица измерения                        |
| description | TEXT          |       | Описание физического смысла              |

---

# 2.4 Степень износа

## ENUM `wear_severity`

Унифицированная шкала оценки состояния.

| Значение  | Описание              |
| --------- | --------------------- |
| OK        | Норма                 |
| EARLY     | Ранняя стадия дефекта |
| DEVELOPED | Развитый дефект       |
| CRITICAL  | Критический износ     |

ENUM фиксирован, расширение не предполагается.

---

# 2.5 Текущее диагностическое состояние

## Таблица `equipment_diagnostic_state`

> Текущие расчётные диагностические показатели оборудования
> Связь: 1 оборудование — N индикаторов

| Поле              | Тип           | Обяз. | Описание                        |
| ----------------- | ------------- | ----- | ------------------------------- |
| equipment_id      | BIGINT (FK)   | ✔     | Оборудование                    |
| indicator_type_id | SMALLINT (FK) | ✔     | Тип диагностического индикатора |
| value             | NUMERIC(14,4) | ✔     | Расчётное значение              |
| severity          | wear_severity | ✔     | Степень дефекта                 |
| damage_index      | NUMERIC(12,4) |       | Накопленный индекс повреждения  |
| calculated_at     | TIMESTAMP     | ✔     | Время расчёта                   |

### Первичный ключ

```
(equipment_id, indicator_type_id)
```

---

# 3. Архитектурная схема связей

```
equipment
   │
   ├── equipment_resource_state        (1 : 1)
   │
   └── equipment_diagnostic_state      (1 : N)
            │
            └── diagnostic_indicator_type
                     │
                     └── diagnostic_group
```

---

# 4. Набудущее

1. Добавим агрегированный `equipment_health_score`
2. Сделать историю для диагностики equipment_diagnostic_history
