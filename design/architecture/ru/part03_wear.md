# Износ оборудования

Подсистема предназначена для:

* учёта нормативного ресурса оборудования
* расчёта накопленного износа
* хранения диагностических показателей состояния
* агрегированной оценки состояния оборудования
* последующего использования в графиках ТО

Подсистема состоит из:

1. Ресурсного износа
2. Диагностического износа
3. Агрегированного состояния (health score)

---

# 1. Ресурсный износ

## Назначение

Отражает степень выработки паспортного ресурса оборудования на основе накопленной наработки.

Используется для:

* планового ТО
* расчёта остаточного ресурса
* формирования предупреждений

---

## Таблица `equipment_resource_state`

> Текущее расчётное ресурсное состояние
> Связь: 1 : 1 с `equipment`

| Поле                | Тип             | Обяз. | Описание                    |
| ------------------- | --------------- | ----- | --------------------------- |
| equipment_id        | BIGINT (PK, FK) | ✔     | Идентификатор оборудования  |
| base_resource_hours | NUMERIC(14,2)   | ✔     | Паспортный ресурс (часы)    |
| used_resource_hours | NUMERIC(14,2)   | ✔     | Накопленная наработка       |
| remaining_hours     | NUMERIC(14,2)   | ✔     | Расчётный остаточный ресурс |
| calculated_at       | TIMESTAMP       | ✔     | Время последнего расчёта    |

### Вычисляемые значения

```
wear_percent = used_resource_hours / base_resource_hours * 100
```

`wear_percent` в БД не хранится.

---

# 2. Диагностический износ

## Назначение

Отражает текущее техническое состояние оборудования на основе расчётных диагностических параметров.

Модель универсальна и не привязана к конкретному типу оборудования.

---

## 2.1 Группы диагностических показателей

### Таблица `diagnostic_group`

> Классификация индикаторов по физической природе дефекта

| Поле | Тип           | Обяз. | Описание             |
| ---- | ------------- | ----- | -------------------- |
| id   | SMALLINT (PK) | ✔     | Идентификатор группы |
| code | TEXT (UNIQUE) | ✔     | Системный код группы |
| name | TEXT          | ✔     | Название группы      |

### Примеры групп

| code        | name                    |
| ----------- | ----------------------- |
| vibration   | Вибрация                |
| temperature | Температура             |
| load        | Нагрузка                |
| lubrication | Смазка                  |
| electrical  | Электрические параметры |
| structural  | Геометрия / деформация  |

---

## 2.2 Типы диагностических индикаторов

### Таблица `diagnostic_indicator_type`

> Справочник диагностических параметров

| Поле        | Тип                                 | Обяз. | Описание          |
| ----------- | ----------------------------------- | ----- | ----------------- |
| id          | SMALLINT (PK)                       | ✔     | Идентификатор     |
| group_id    | SMALLINT (FK → diagnostic_group.id) | ✔     | Группа            |
| code        | TEXT (UNIQUE)                       | ✔     | Системный код     |
| name        | TEXT                                | ✔     | Название          |
| unit        | TEXT                                |       | Единица измерения |
| description | TEXT                                |       | Описание          |

---

## 2.3 Степень износа

### ENUM `wear_severity`

Фиксированная шкала оценки состояния.

| Значение  | Описание              |
| --------- | --------------------- |
| OK        | Норма                 |
| EARLY     | Ранняя стадия дефекта |
| DEVELOPED | Развитый дефект       |
| CRITICAL  | Критический износ     |

Расширение ENUM не предполагается.

---

## 2.4 Текущее диагностическое состояние

### Таблица `equipment_diagnostic_state`

> Текущее состояние оборудования по диагностическим индикаторам
> Связь: 1 оборудование — N индикаторов

| Поле              | Тип           | Обяз. | Описание                       |
| ----------------- | ------------- | ----- | ------------------------------ |
| equipment_id      | BIGINT (FK)   | ✔     | Оборудование                   |
| indicator_type_id | SMALLINT (FK) | ✔     | Тип индикатора                 |
| value             | NUMERIC(14,4) | ✔     | Расчётное значение             |
| severity          | wear_severity | ✔     | Степень дефекта                |
| damage_index      | NUMERIC(12,4) |       | Накопленный индекс повреждения |
| calculated_at     | TIMESTAMP     | ✔     | Время расчёта                  |

### Первичный ключ

```
PRIMARY KEY (equipment_id, indicator_type_id)
```

---

# 3. Агрегированное состояние оборудования

## Назначение

Даёт единый интегральный показатель состояния оборудования (`health_score`).

Используется для:

* ранжирования оборудования
* определения приоритетов ТО
* аварийных триггеров
* построения дашбордов

---

## Принцип расчёта

`health_score` формируется из:

* ресурсного износа
* диагностических показателей

Диапазон: **0 – 100**

---

## Таблица `equipment_health_state`

> Агрегированное состояние оборудования
> Связь: 1 : 1 с `equipment`

| Поле                 | Тип             | Обяз. | Описание               |
| -------------------- | --------------- | ----- | ---------------------- |
| equipment_id         | BIGINT (PK, FK) | ✔     | Оборудование           |
| health_score         | NUMERIC(5,2)    | ✔     | 0–100                  |
| resource_component   | NUMERIC(5,2)    | ✔     | Вклад ресурсной модели |
| diagnostic_component | NUMERIC(5,2)    | ✔     | Вклад диагностики      |
| severity             | wear_severity   | ✔     | Итоговая степень риска |
| calculated_at        | TIMESTAMP       | ✔     | Время расчёта          |

---

## Интерпретация health_score

| health_score | severity  |
| ------------ | --------- |
| ≥ 70         | OK        |
| 40–69        | EARLY     |
| 10–39        | DEVELOPED |
| < 10         | CRITICAL  |

(правила могут быть параметризованы)

---

# 4. Общая схема связей

```
equipment
   │
   ├── equipment_resource_state        (1 : 1)
   │
   ├── equipment_diagnostic_state      (1 : N)
   │        │
   │        └── diagnostic_indicator_type
   │                 │
   │                 └── diagnostic_group
   │
   └── equipment_health_state          (1 : 1)
```

---

# 5. Архитектурные принципы

* JSON не используется
* Все параметры типизированы
* Степень износа унифицирована (ENUM)
* Модель расширяема через справочник индикаторов
* Поддерживается аналитика и индексация
* Ресурсная и диагностическая модели независимы
* Агрегированная модель не дублирует исходные данные

---

# 6. Набудущее

2. Сделать историю для диагностики equipment_diagnostic_history
