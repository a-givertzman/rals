# Система мониторинга оборудования и палнирования ТО

Компактная версия на гитхабе:  
https://github.com/a-givertzman/rals/issues/2

---

## 1. Общие сведения

Программное обеспечение рассчитано на масштаб предприятия и может объединять оборудование одного или нескольких цехов.

Все площадки и оборудование выстраиваются в древовидную структуру.

---

## 2. Основные модули

- Система мониторинга текущего состояния оборудования
  - Отслеживание параметров режима работы в реальном времени
  - Сбор исторических данных
  - Анализ параметров режима работы оборудования
  - Анализ вибрации
  - Прогнозирование износа
  - Рекомендации по внеплановому обслуживанию (в будущих версиях)

- Планирование ТО
  - Обзор всего оборудования
  - Типизация элементов оборудования
  - Типизация задач ТО
  - Планирование ТО и трудозатрат (базовые функции, не заменяет ERP)
  - Подготовка спецификаций для закупок (Простые списки)

---

## 3. Архитектура

- **Данные**
  - Обмен с бэклм - на именованных событиях
    - Классификация событий
      - Inf - спонтанное событи (от бэка к фронту)
      - Rec - запрос от фронта к бэку, требующий обязательного скорейшего ответа
      - ReqCon - ответ с данными на запрос Rec
      - ReqErr - ответ с ошибкой на запрос Rec
      - Cmd - команда фронта бэку, не требует обязательного ответа (например кнопки Прибавит / Убавить - не требуют ответа)
      - CmdCon - Необязательное положительное подтверждение команды Cmd (может быть использовано для интерфейсов, подразумевающих подверждение успешного выполнения команды)
      - CmdErr - Необязательное отрицательное подтверждение команды Cmd

  - Общие правила использования событий
    - **Req** - для получения данных по **Пользователям**, **Оборудованию**, **Работам**, **Документам** и **Подтверждениям**
    - **Inf** - для спонтанной передачи статусов **Warn** и **Alarm**

  - Реконнект - автоматический
    - При обрывах и восстановлении связи обновляется статус в строке состояния
    - А так же бэк пришлет события закэшенные для этой линии, если они вообще есть (при условии что подключение было восстановлено в пределах всего нескольких минут)
    - Данные идущие по запросу останутся без изменений

- **Пользователи**
  - Авторизация
  - Группы
    - Админ
      - Полный доступ ко всем функциям систкемы (для разработчика и поставщика)
    - Инженер
      - Добавление, удаление Операторов
      - Редактирует Оборудование
      - ~~Дает дополнительные разрешения Операторам~~ - Может реализуем в следующих версиях редактор ролей
      - Планирование Работ
      - Подтверждение закрытия работ
    - Оператор
      - Обзор всех функций системы
      - Квитирование событий
      - Для окончательного завершения работ необходима виза Инженера

  - События безопасности логируются в общий список событий с классом Info
    - Авторизация пользователей
    - Добавление / удаление пользователей
    - Изменение прав пользователей
    - Квитирование событий

- **Оборудование** (дерево)

  - Импортировать из таблички
    - Дерево обычно небольшое, не будет превышать несколько тысяч записей, загружается целиком из базы в стейт фронтенда
    - Узел дерева всегда имеет только одного родителя
    - Из E-Plan в формате csv, делается разработчиком системы, не является функцией для конечного пользователя
    - Примерный вид таблицы

      | id | parent_id | name | title | param1 | param2 | ... |
      |----|-----------|------|-------|--------|--------|-----|
      | 1 | null | АБВГ.XXXXXX.001 | Кран мостовой | height: 30m | width: 40m |  |
      | 2 | 1 | АБВГ.XXXXXX.002 | Лебедка главная | length: 100m |  |  |

      - id - уникальный признак в E-Plan
      - parent_id - id родительского элемента
      - name - Пректное наименование
      - title - Человеческое название
      - param's - необходимый набор технических параметров оборудования, определяется расчетами износа и инженером по ТО

  - Отобразить в виде дерева
  - **Характеристики оборудования**
  - **Документы**
  - **Графики ТО** (список / календарь)
    - Работы по ТО планируются пользователем
      - Внеплановые по заданным датам
      - Плановые ТО периодичностью

  - **Сигнализация** (Класс, timestamp, Текст, Кометарий - можно вписать отвественного или что иное)
    - Пишется в историю
    - Хранится 3..5 лет (по желанию заказчика настраивается разработчиком / наладчиком)
    - Отображается в двух списках
      - **Список событий** - историческая хронология всех событий, может быть отфильтрована по датам, по Классу тревоги, по тексту
      - **Список тревог** - список активных в данный момент тревог
        - Необходим для того что бы зафиксировать...
        - Событие попадает в список тревог при наличии у него **Флага Тревога:**
        - В **список Активных** - пока имеет значение логической "1" (причины тревоги не устранены)
          - Активная аврия не может быть сквитирована - требует устранения
          - Но можем дать возможность квитирования для **Инженера**, с автоматическим каким-то соментом и логированием в общую историю
          - Или еще какой-то обходной путь сквитировать то что не устранить, но в списке мешает
        - В **список Пролетевших** - если значение измениться с "1" на "0" (причина тревоги устранена)
          - Будет удалено из пролетевших после квтирования
          - Квитирование выполняется с подтверждением и по желанию может быть прокомментировано, событие квитирования пишется в общий лог
          - Квитировать может Оператор, Инженер, Админ

    - **Классы тревоги** событий сигнализации
      - **Info** | ℹ️ | Default | Информационное сообщение
      - **Warning** | ⚠️ | Желтый | Предупредительная сигнализация, требует внимания персонала, не препятствует дальнейшей работе
      - **Error** | ❌ | Error | Возможно нужно выделить ошибки (в приложении, связи, на бэкенде) в отдельную категорию
      - **Alarm** | ◯ | Красный | Аварийная сигнализация, требует срочной реакции персонала, дальнейшая работа невозможна

---

## Статус Работы

Статус работы определяет её текущее состояние и допустимые переходы.

### Возможные статусы:

- Planned
- InProgress
- Paused
- Confirmation
- Completed
- Cancelled

---

### Матрица переходов статусов

| Текущий статус | Planned | InProgress | Paused | Confirmation | Completed | Cancelled |
|-----------------|----------|------------|--------|--------------|-----------|------------|
| **Planned** |  | -> |  |  |  | -> |
| **InProgress** |  |  | -> | -> |  | -> |
| **Paused** |  | -> |  | -> |  | -> |
| **Confirmation** |  |  |  |  | -> | -> |
| **Completed** |  |  |  |  |  |  |
| **Cancelled** |  |  |  |  |  |  |

---

## Логика переходов

- Planned -> InProgress
- Planned -> Cancelled

- InProgress -> Paused
- InProgress -> Confirmation
- InProgress -> Cancelled

- Paused -> InProgress
- Paused -> Confirmation
- Paused -> Cancelled

- Confirmation -> Completed
- Confirmation -> Cancelled

---

## Роли и влияние на статусы

- Оператор
  - Может перевести Planned -> InProgress
  - Может перевести InProgress -> Paused
  - Может перевести Paused -> InProgress
  - Может перевести InProgress -> Confirmation
  - Может перевести Paused -> Confirmation

- Инженер
  - Может подтвердить Confirmation -> Completed
  - Может перевести любую работу в Cancelled

- Админ
  - Полный контроль над переходами

---

## Подтверждение завершения работ

- После перевода в статус Confirmation:
  - Работа ожидает проверки
  - Инженер обязан проверить корректность выполнения
  - При подтверждении статус меняется на Completed
  - При отклонении возможно возвращение в InProgress

---

## Жизненный цикл работы

1. Создание работы — статус Planned
2. Начало выполнения — InProgress
3. Приостановка (если требуется) — Paused
4. Возобновление — InProgress
5. Передача на проверку — Confirmation
6. Завершение — Completed

Или в любой допустимый момент -> Cancelled

---

## Дополнительно

- Все изменения статусов логируются
- Фиксируется:
  - Пользователь
  - Время
  - Предыдущий статус
  - Новый статус
  - Комментарий (опционально)

- История изменений недоступна для редактирования

---

## Примечания

- Completed и Cancelled являются финальными статусами
- После достижения финального статуса дальнейшие переходы невозможны
- Отмена (Cancelled) может быть выполнена до завершения работ
- Повторное открытие Completed работы не предусмотрено

---

## Статус Работы

Статус работы определяет её текущее состояние и допустимые переходы.

### Возможные статусы:

- Planned
- InProgress
- Paused
- Confirmation
- Completed
- Cancelled

---

### Матрица переходов статусов


| Текущий статус | Planned | InProgress | Paused | Confirmation | Completed | Cancelled |
|-----------------|----------|------------|--------|--------------|-----------|------------|
| **Planned** |  | -> |  |  |  | -> |
| **InProgress** |  |  | -> | -> |  | -> |
| **Paused** |  | -> |  | -> |  | -> |
| **Confirmation** |  |  |  |  | -> | -> |
| **Completed** |  |  |  |  |  |  |
| **Cancelled** |  |  |  |  |  |  |

---

## Логика переходов

- Planned -> InProgress
- Planned -> Cancelled

- InProgress -> Paused
- InProgress -> Confirmation
- InProgress -> Cancelled

- Paused -> InProgress
- Paused -> Confirmation
- Paused -> Cancelled

- Confirmation -> Completed
- Confirmation -> Cancelled

---

## Роли и влияние на статусы

- Оператор
  - Может перевести Planned -> InProgress
  - Может перевести InProgress -> Paused
  - Может перевести Paused -> InProgress
  - Может перевести InProgress -> Confirmation
  - Может перевести Paused -> Confirmation

- Инженер
  - Может подтвердить Confirmation -> Completed
  - Может перевести любую работу в Cancelled

- Админ
  - Полный контроль над переходами

---

## Подтверждение завершения работ

- После перевода в статус Confirmation:
  - Работа ожидает проверки
  - Инженер обязан проверить корректность выполнения
  - При подтверждении статус меняется на Completed
  - При отклонении возможно возвращение в InProgress

---

## Жизненный цикл работы

1. Создание работы — статус Planned
2. Начало выполнения — InProgress
3. Приостановка (если требуется) — Paused
4. Возобновление — InProgress
5. Передача на проверку — Confirmation
6. Завершение — Completed

Или в любой допустимый момент -> Cancelled

---

## Дополнительно

- Все изменения статусов логируются
- Фиксируется:
  - Пользователь
  - Время
  - Предыдущий статус
  - Новый статус
  - Комментарий (опционально)

- История изменений недоступна для редактирования

---

## Примечания

- Completed и Cancelled являются финальными статусами
- После достижения финального статуса дальнейшие переходы невозможны
- Отмена (Cancelled) может быть выполнена до завершения работ
- Повторное открытие Completed работы не предусмотрено

---


