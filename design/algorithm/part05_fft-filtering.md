# **Анализ вибраций двигателя с помощью FFT-фильтрации**

**Анализ вибраций** – ключевой инструмент диагностики механизмов. Для обработки данных в реальном времени используется быстрое преобразование Фурье (FFT), позволяющее выделять значимые изменения и снижать объем хранимой информации.  

FFT-фильтрация упрощает анализ, повышает производительность системы и  детектирует изменения в состоянии двигателя без избыточного хранения данных.

**1. Сбор данных**
- 

Система получает данные от датчиков вибрации двигателя с высокой частотой дискретизации – 300 000 Гц (300 000 точек в секунду), что позволяет фиксировать мельчайшие изменения в работе механизма.

**2. Применение FFT и разбиение на временные окна**
- 

- Данные разбиваются на окна по `30 000 точек`, что соответствует `0.1 секунды` сигнала.

- Анализ выполняется на `10 таких окон подряд`, охватывая в сумме `1 секунду` (300 000 точек).

- К каждому окну применяется быстрое преобразование Фурье (FFT), что позволяет перейти от временного представления к частотному и выделить характерные колебания двигателя.

**3. Фильтрация значимых изменений (Integrated threshold filter)**
-

1. Спектры сравниваются между последовательными окнами.

2. Для каждой частотной компоненты вычисляется разница амплитуд.

3. Применяется интегральный фильтр (**Integrated threshold filter**). Алгоритм интегрального фильтра следующий:

- **Инициализация**. Начальное значение `value` устанавливается равным первому входному значению, а начальная $\delta$ равна 0:

   $$ value_1 = input_1 $$
   $$\delta_1 = 0$$

- **Расчет дельты (интегрирование изменений)**. Вычисляется текущая $\delta$:

   $$ \delta_i = \delta_{i-1} + |value_{i-1} - input_i| * K_{int} $$

   *Пояснение:*
   - $|value_{i-1} - input_i|$ — абсолютное изменение между предыдущим сохранённым значением и новым входным данным.

   - $K_{int}$ — коэффициент интегрирования (чувствительности), который определяет, как сильно накапливаются изменения

   - Дельта накапливает изменения, если входные данные колеблются вокруг value
   
- **Проверка порога**: если выполняется следующее условие 
      $$\delta_i > threshold$$
   
- То обновляется значение:

   $$value_i = input_i$$

   (Текущее входное значение становится новым эталонным)
- Сбрасывается $\delta$:

   $$ \delta_i = 0 $$

- **Повторение процесса** — переход к шагу 2.

**Пример** 

*Условия примера*

- Начальное значение: $value_1 = 10.0$ (первое входное значение).
- Начальная дельта: $\delta_1 = 0$.
- Коэффициент интегрирования: $K_{int} = 0.5 $(умеренная чувствительность).
- Порог срабатывания: $threshold = 1.0.$
- Входные данные: $[10.0, 10.2, 10.1, 10.5, 11.0, 10.8, 10.9, 11.5]$.

**Шаг 1: Инициализация**  

- $input_1$ = 10.0
- $value_1$ = 10.0
- $\delta_1$ = 0

**Шаг 2: Входное значение** $input_2 = 10.2$

1. Вычисляем изменение:

$|value_1 - input_2| = |10 - 10.2| = 0.2$

2. Обновляем дельту:

$ \delta_2 = \delta_{1} + 0.2 * K_{int} = 0 + 0.2 * 0.5$

3. Проверка порога:

$0.1 < 1.0 => value_2 = value_1 = 10.0$

**Итог**:  
$value_2 = 10.0,$   $\delta_2 = 0.1$

**Шаг 3: Входное значение** $input_3 = 10.1$

1. Вычисляем изменение:

$|value_2 - input_3| = |10 - 10.1| = 0.1$

2. Обновляем дельту:

$ \delta_3 = \delta_2 + 0.1 * 0.5 = 0.1 + 0.05 =0.15$

3. Проверка порога:

$0.15 < 1.0 => value_3 = value_2 = 10.0$

**Итог**:  
$value_3 = 10.0,$   $\delta_3 = 0.1$

**В итоге получим следующую таблицу:**
--
|Шаг|Вход (input)|Текущее value|Накопленная delta|Порог (threshold)|	Обновление?|
|-|-|-|-|-|-|
|1	|10.0|	10.0	|0.0	      |1.0|Нет|
|2	|10.2|	10.0	|0.1	      |1.0|Нет|
|3	|10.1|	10.0	|0.15	      |1.0|Нет|
|4	|10.5|	10.0	|0.4	      |1.0|Нет|
|5	|11.0|	10.0	|0.9	      |1.0|Нет|
|**6**	|**10.8**|	**10.8**	|**0.0 (сброс)**|**1.0**|**Да**|
|7	|10.9|	10.8	|0.05       |1.0|Нет|
|8	|11.5|	10.8	|0.4        |1.0|Нет|


**Выводы**

- **Порог срабатывания:**
Значение value обновилось только на 6-м шаге, когда накопленная дельта (1.3) превысила threshold = 1.0.

- **Фильтрация шума:**
Малые колебания (например, 10.0 → 10.2 → 10.1) не привели к обновлению value, так как их суммарное влияние было ниже порога.

- **Роль $K_{int}$:**  
При $K_{int}$ = 0.5 изменения "усредняются", делая алгоритм менее чувствительным к шуму.
Если бы $K_{int}$ = 1.0, обновление произошло бы раньше (например, на 5-м шаге).

Этот пример показывает, как Integrated Threshold может использоваться для подавления шума и реагирования только на значимые изменения.


**4. Запись и хранение данных**
-

- Фиксируются только изменяющиеся частоты, что существенно снижает объем данных.

- Данные следует сохранять в виде: `«частота – амплитуда – временная метка»`, что упрощает дальнейший анализ.

- Система накапливает данные с возрастающим интервалом хранения:

   - **Суточное хранение** (для часто изменяющихся частот).

   - **Месячное хранение** (для менее динамичных изменений).

   - **Годовое хранение** (для редких изменений).

Такой подход позволяет фиксировать важные изменения в состоянии двигателя, обеспечивая диагностику потенциальных неисправностей без избыточного хранения.

**5. Учет переходных режимов (пуск, останов, изменение скорости вращения)**
-
Для контроля режимов работы используется датчик частоты вращения. Необходимо учитывать ключевые состояния двигателя:

- **Пуск** – резкое нарастание частоты вращения.

- **Останов** – резкое снижение частоты.

- **Стабильный режим** – частота вращения постоянна или изменяется незначительно.

- **Переходный процесс (разгон/замедление)** – плавные изменения скорости.

В переходных режимах стоит учесть адаптивную фильтрацию FFT-данных:

- Временно повышать порог чувствительности, чтобы исключить естественные изменения вибраций.
> ***Например** если в стабильном режиме threshold 1%, то в переходных режимах 5-10%*

- Корректировать анализ с учетом изменения частоты вращения, особенно при расчете амплитуд гармоник.  

>  ***Например**: Двигатель работает на 3000 об/мин → основная частота = 50 Гц. Разгон до 6000 об/мин → основная частота = 100 Гц. Вместо сравнения "50 Гц и 100 Гц" как разных событий, анализируется их как 1-я гармоника текущей скорости.*

- Исключать частоты, существующие лишь в одном или двух окнах FFT (артефакты разгона/остановки).
>  ***Пример**: Если некая частота появилась на 1 окне FFT (0.01 с) и исчезла – это, скорее всего, ложная частота. Если частота сохраняется на 5+ окнах подряд (0.05 с и дольше) – это уже значимое изменение.*

- Основной анализ следует выполнять в стабильных режимах, а в переходных учитывать только трендовый контроль вибраций.
